#!/bin/bash

# =====================================================
# SCRIPT TEST NOTIFIKASI LENGKAP
# =====================================================

echo "üîî =============================================="
echo "üîî TEST NOTIFIKASI FCM"
echo "üîî =============================================="
echo ""

echo "üì± OPSI 1: Test via Firebase Console (Paling Mudah)"
echo "=============================================="
echo ""
echo "1. Ambil FCM Token dari app (login dulu!)"
echo "   Cek console log: üîë FCM TOKEN: [token]"
echo ""
echo "2. Buka Firebase Console:"
echo "   https://console.firebase.google.com/project/roasty-9b753/notification/compose"
echo ""
echo "3. Isi form:"
echo "   - Notification title: üöö Test Notifikasi"
echo "   - Notification text: Ini test dari Firebase Console"
echo "   - Target: Single device"
echo "   - FCM token: [paste token dari step 1]"
echo ""
echo "4. PENTING! Klik 'Additional options' ‚Üí Tab 'Custom data'"
echo "   Tambahkan key-value:"
echo "   type = order_status"
echo "   resource_id = TEST-001"
echo "   target_screen = order_detail"
echo "   action = shipped"
echo ""
echo "5. Klik 'Test'"
echo ""
echo "‚úÖ Notifikasi harusnya muncul di HP!"
echo ""
echo "=============================================="
echo ""

echo "üì± OPSI 2: Test via Edge Function (Otomatis)"
echo "=============================================="
echo ""
echo "1. Pastikan sudah login di app & FCM token tersimpan"
echo ""
echo "2. Jalankan SQL di Supabase SQL Editor:"
echo "   (Lihat file: QUICK_TEST_FCM.sql)"
echo ""
echo "3. Panggil Edge Function:"
echo ""
echo "curl https://fiyodlfgfbcnatebudut.supabase.co/functions/v1/send-push-notifications \\"
echo "  -H \"Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZpeW9kbGZnZmJjbmF0ZWJ1ZHV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5OTQ0MDIsImV4cCI6MjA3ODU3MDQwMn0.pHruuh0dqQa3oUbwqYjbzEjzFiha0jFhcvO93DfkOlk\""
echo ""
echo "4. Expected response:"
echo '   {"success":true,"processed":1,"sent":1}'
echo ""
echo "‚úÖ Notifikasi harusnya muncul di HP!"
echo ""
echo "=============================================="
echo ""

echo "‚ùå TROUBLESHOOTING"
echo "=============================================="
echo ""
echo "Jika notifikasi TIDAK muncul:"
echo ""
echo "1. CEK TOKEN TERSIMPAN:"
echo "   SELECT * FROM fcm_tokens WHERE is_active = true;"
echo "   ‚Üí Harus ada minimal 1 row"
echo ""
echo "2. CEK EDGE FUNCTION SECRET:"
echo "   ‚Üí Buka Supabase Dashboard ‚Üí Settings ‚Üí Edge Functions ‚Üí Secrets"
echo "   ‚Üí Cek apakah FIREBASE_SERVICE_ACCOUNT sudah di-set"
echo "   ‚Üí Jika belum: lihat SETUP_FCM_SERVER_KEY.md"
echo ""
echo "3. CEK LOG EDGE FUNCTION:"
echo "   ‚Üí Buka Supabase Dashboard ‚Üí Edge Functions ‚Üí Logs"
echo "   ‚Üí Cari error message"
echo ""
echo "4. CEK APP LOG:"
echo "   ‚Üí Pastikan ada log: üîë FCM TOKEN: [token]"
echo "   ‚Üí Pastikan ada log: ‚úÖ FCM token saved to Supabase"
echo ""
echo "5. REBUILD APP:"
echo "   flutter clean && flutter run"
echo ""
echo "=============================================="
